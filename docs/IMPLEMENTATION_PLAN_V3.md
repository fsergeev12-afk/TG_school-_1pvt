# Implementation Plan — MVP v3.0

Source of truth: `PRD_Telegram_Course_Platform_MVP_v3_0.md`, `v0_prompts_v3_0.md`. Screens from `shablony for front/` — only как визуальные референсы, функционал берем из PRD v3.0.

## 1) Общие принципы
- Удаляем/не используем все DEMO/заглушки, кнопки всегда активны по ТЗ.
- Биллинг: активная кнопка оплаты ведет на внешнюю платежную ссылку (вероятно ЮKassa). Интерфейс успешной/ошибочной оплаты обязателен; при возврате обрабатываем статус через query params/state.
- Мультикурсовость без лимитов; статусы учеников: Приглашен+не оплачено / Активен+не оплачено / Активен+оплачено.
- Расписание на уровне уроков; уведомления через Telegram Bot.
- Чаты: централизованный inbox, непрочитанные, фильтр по потокам, диалоги; ответы уходят через Bot API.
- Видео: гибрид (file_id до 50MB или внешняя ссылка). Материалы: PDF/DOC до 50MB. Обложки курсов: JPG/PNG до 5MB.

## 2) Фронтенд — что переделать (не стартуя новые этапы)
### Ученик
- Dashboard/course card: реальный курс, два статуса доступа (первый урок доступен / все доступны), без демо-курсов.
- Course page (блоки/уроки): заблокированные уроки → оплата; заблокированные по дате → модалка с датой.
- Lesson page: кнопка «Задать вопрос» → редирект в бота; гибридное видео; список материалов; навигация между уроками.
- Payment screen: активная «Оплатить», ввод промокода (free/скидка), модалки успех/ошибка; внешний redirect на платеж.

### Создатель
- Bottom navigation: 4 вкладки (Курсы/Потоки/Чаты/Настройки).
- Курсы: нет лимита 1 курс; загрузка обложки; создание курса 2 шага (инфо + структура с drag-and-drop, тип урока, материалы).
- Потоки: 4 шага (выбор курса → расписание уроков чекбокс → уведомления → название); цена курса; привязка промокодов через настройки.
- Детальная потока: вкладки Ученики/Рассылка/Оплаты/⚙️ — Оплаты берёт реальные данные; статусы учеников по v3; непрочитанные метки переходят в Чаты.
- Промокоды: список/создание/редактирование/лимиты/сроки/типы.
- Чаты: список диалогов с фильтром по потокам, индикатор непрочитанных; экран диалога с отправкой сообщения.

## 3) Бэкенд — что доработать
- Биллинг: endpoint для генерации внешней платежной ссылки; обработка возврата/статуса; интерфейс webhook под провайдера (пока заглушка-стаб для статуса).
- Telegram Bot: webhook входящих, отправка ответов; deep link по stream_id; уведомления (велком после оплаты/промокода, открытие урока, рассылка, ответ создателя, ошибка оплаты, напоминание об оплате).
- Cron расписания: открытие уроков и нотификация.
- Promo codes: валидация (срок, лимит, повторное использование), применение; free → auto-paid.
- Файлы: загрузка материалов (Telegram file_id), обложки (CDN/S3), видео (file_id или URL).

## 4) Данные/схема (миграции)
- Новые таблицы: `messages`, `conversations`, `promo_codes`, `promo_code_usages`, `lesson_schedules`, `lesson_materials`.
- Расширения: `courses` (cover_image_url, description), `lessons` (video_type, video_telegram_file_id, video_external_url, description), `blocks` (description), `streams` (price, schedule_enabled), `stream_students` (invitation_status, payment_status, activated_at, paid_at).
- Индексы/UNIQUE как в PRD v3.0.

## 5) Очистка перед git
- Оставить в `docs/` только: `PRD_Telegram_Course_Platform_MVP_v3_0.md`, `v0_prompts_v3_0.md`, `IMPLEMENTATION_PLAN_V3.md`, актуальные техдоки. Архив уже создан в `docs/archive/`.
- Удалить/исключить временные экспорты, `__MACOSX`, html/mhtml мок, если не нужны в репозитории (по согласованию).
- Проверить `.gitignore` на build/secret файлы.

## 6) Следующие шаги (предложение)
- Обновить README/QUICK_START ссылками на PRD v3.0 и этот план.
- Составить задачник по фронту/бэку из пунктов выше (гранулярные тикеты).
- Согласовать платежный провайдер (ЮKassa предпочтительно); описать callback/redirect flow.


